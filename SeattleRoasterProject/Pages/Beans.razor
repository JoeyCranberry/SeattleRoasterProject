@page "/beans/{quizQueryString?}"

@inject SearchBeanEncoderService searchServ

<BeanFilterDisplay OnBeanFilterSearch="HandleFilterSearch" OnSortChanged="HandleSortChanged"></BeanFilterDisplay>
<BeanLisiting @ref="listing"></BeanLisiting>

@code {
	private BeanLisiting? listing;

	[Parameter]
	public string? quizQueryString { get; set; }

	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		if(!String.IsNullOrEmpty(quizQueryString) && listing != null)
		{
			await listing.ApplyFilter(searchServ.DecodeQuizResult(quizQueryString));
		}
	}

	private async Task HandleFilterSearch(BeanFilter filter)
	{
		if (listing != null)
		{
			await listing.ApplyFilter(filter);
		}
	}

	private void HandleSortChanged(SortMethod method)
	{
		if (listing != null)
		{
			listing.SetActiveSort(method);
		}
	}
}
